version: '3.8'

services:
  # --- æœåŠ¡ 1: åç«¯ API ---
  backend:
    build: .
    container_name: securag_backend
    command: uvicorn api_server:app --host 0.0.0.0 --port 8000
    ports:
      - "8000:8000"
    volumes:
      - ./data:/app/data               # æŒ‚è½½æ•°æ®ç›®å½•
      - ./my_local_db:/app/my_local_db # æŒ‚è½½å‘é‡åº“ï¼Œä¿è¯æ•°æ®æŒä¹…åŒ–
    environment:
      # âœ… å›å½’å®˜æ–¹æ¨èåœ°å€ (åˆšæ‰æµ‹è¯•çŠ¶æ€ç  200 çš„é‚£ä¸ªï¼)
      - OLLAMA_HOST=http://host.docker.internal:11434
      
      # ğŸ›¡ï¸ å¼ºåˆ¶ç»•è¿‡ä»£ç† (æŠŠ host.docker.internal åŠ å…¥ç™½åå•)
      - NO_PROXY=localhost,127.0.0.1,host.docker.internal
      - no_proxy=localhost,127.0.0.1,host.docker.internal
    extra_hosts:
      - "host.docker.internal:host-gateway" # Linux/Windows å…¼å®¹æ€§é…ç½®

  # --- æœåŠ¡ 2: å‰ç«¯ UI ---
  frontend:
    build: .
    container_name: securag_frontend
    command: python -m streamlit run frontend.py --server.port 8501 --server.address 0.0.0.0
    ports:
      - "8501:8501"
    environment:
      # å‘Šè¯‰å‰ç«¯ï¼Œåç«¯åœ¨å“ª (å®¹å™¨å†…éƒ¨ç½‘ç»œäº’è”)
      - API_BASE_URL=http://backend:8000 
    depends_on:
      - backend # åªæœ‰åç«¯å¯åŠ¨äº†ï¼Œå‰ç«¯æ‰å¯åŠ¨